// Generated by LiveScript 1.2.0
window.WCIO = {};
window.WCIO.main = function(){
  var vc, audioContext, thumbs, roomID, ref$;
  vc = new VideoChat();
  audioContext = new webkitAudioContext();
  thumbs = document.getElementById('thumbnails');
  vc.onaddstream = function(video, stream){
    var source, analyser;
    source = audioContext.createMediaStreamSource(stream);
    analyser = audioContext.createAnalyser();
    source.connect(analyser);
    setInterval(function(){
      var freqByteData, volume;
      freqByteData = new Uint8Array(analyser.frequencyBinCount);
      analyser.getByteTimeDomainData(freqByteData);
      volume = (Math.max.apply(Math, freqByteData) - 128) / 128;
      video.className = volume ? 'talking' : '';
    }, 100);
    thumbs.appendChild(video);
  };
  vc.onuserleft = function(it){
    var video;
    video = document.getElementById(it);
    video && video.parentNode.removeChild(video);
  };
  roomID = (ref$ = window.location.href.match(/[^/]+$/g)) != null ? ref$[0] : void 8;
  if (!roomID) {
    roomID = 'xxxxxx'.replace(/[x]/g, function(){
      return (Math.random() * 36 | 0).toString(36);
    });
    window.history.replaceState({}, "New Room ID", "/" + roomID);
  }
  return vc.setSignaller(new SignallerSocketIO(vc)).connect("http://amar.io:9980", function(){
    console.log("Joining room " + roomID);
    vc.join("webcamio-" + roomID);
  });
};